---
title: react dom diff 算法
date: 2019-02-10 14:53:54
tags:
- React
---

考虑这么一个问题：使用react的时候，我们实现一个列表，又忘了给列表提供key，会遇到一个常见的警告。无视这个警告，通常依然可以正常工作。那这个key是用来干嘛的？

React维护了virtual dom来提高性能。当state发生变化时，virtual dom相应改变，然后由react来进行比较，体现在ui上的改变。给定任意的两棵树，找到最少的转换步骤，标准的算法是一个O(n^3)的算法。React做了以下连个合理的假设，把复杂度变成了O(n)。

- 两个相同的component产生类似的dom结构，不同的component产生不同的dom结构。
- 对于同一层次的一组节点，可以通过唯一id来区分。

react比较前后两个virtual dom node时，分两种情况

1. 节点类型不同：这时，react直接删除旧节点，再创建新节点。
2. 相同类型，属性不同：重设节点属性。

react的dom diff算法只会逐层比较。对于不同层节点，只有简单的创建和删除。

** 保持稳定的dom结构，可以提高性能 **

回答开始的问题，比如说一个列表为A-B-C-D-E-F,更新后为A-B-B1-C-D-E-F，如果不加入key，则实际的变化是：

C->B1, D->C, ....
